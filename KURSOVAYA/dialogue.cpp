#pragma once
#include <iostream>
#include <string>
#include "Windows.h"
#include "dialogue.h"
#include "services.h"

using namespace std;

void Dialogue::loop() {
	clear_all();
	string current_object = "blacksmith";

	while (true) {
		if (GetAsyncKeyState(VK_ESCAPE) & 0x8000) {
			beautiful_clear_all();
			// Ждем чтобы случайно не затригерить выход из основного цикла
			Sleep(100);
			break;
		}

		// Чиним если был выход из полноэкранного режима
		if (!check_console_size_changes()) {
			clear_all();
		}


		if (current_object == "princess") {
			if (check_right_left_buttons()) {
				current_object = "blacksmith";
				beautiful_clear_all();
				//Sleep(200);
				continue;
			}
			process_princess();
		}
		else if (current_object == "blacksmith") {
			if (check_right_left_buttons()) {
				current_object = "princess";
				beautiful_clear_all();
				//Sleep(200);
				continue;
			}
			process_blacksmith();
		}
		Sleep(15);
	}
}

void Dialogue::print_dialogue_frame(const string& text, const string& heading) {
	set_text_color("green");
	move_cursor((get_console_width() - get_first_line_width(text) - heading.length()) / 2 + get_first_line_width(text) + 2);
	cout << heading;

	set_text_color("purple");
	clear(get_first_line_width(text) + 1, 1, get_console_width() - get_first_line_width(text) - 1, '_');
	clear(get_first_line_width(text) + 2, get_console_height() - 1, get_console_width() - get_first_line_width(text) - 3, '_');

	for (int i{ 2 }; i < get_console_height(); i++) {
		move_cursor(get_first_line_width(text) + 1, i);
		cout << '|';
		move_cursor(get_console_width() - 1, i);
		cout << '|';
	}

	set_color();
}

void Dialogue::process_princess() {
	print_dialogue_frame(princess, "Принцесса");
	move_cursor();
	cout << princess;


}

void Dialogue::process_blacksmith() {
	print_dialogue_frame(blacksmith, "Кузнец");
	move_cursor();
	cout << blacksmith;


}

string Dialogue::princess =
R"(++++********######%%%%%%@@@@@@@@@@@@@@@@@@@*@@@@@@@@@@@@@@@@@@@@@%%######*****++++++
++++*******######%%%%%%@@@@@@@@@@@@@@@@@@@@##@@@@@@@@@@@@@@@@@@@@%%%######*****+++++
++++*******#####%%%%%@@@@@@@@@@@@@@@@@@@@+%@%@@@@@@@@@@@@@@@@@@@@@%%%#####*****+++++
++++*******####%%%%%@@@@@@@@@@@@@@@@@@@%%+%+=@%#@@@@@@@@@@@@@@@@@@%%%#####*****+++++
+++++*****#####%%%%@@@@@@@@@@@@@#@@@%@@*%@@%==+@***+@*@@@@@@@@@@@@%%%######****++++=
++++++****####%%%%%@@@@@@@@@@@@+@@@@@@@*@@@%=++##@@++@++*@%*@@@@@@@%%%####*****++++=
=++++++****###%%%%%@@@@@@*@@#@#@@@+*+@=*%@%+=-=##==%=*%+@+#=@@@@@@@%%%%###******+++=
=+++++++***###%%%%%%@@@@@%@=+==%*@+**@++@+@=%=@@=*#*-##==*#+*@@@@@%%%%%###******+++=
==++++++***####%%%%%@#@@@#%@***#=@=@=@@@@@@@@@@#-=##+-%-#@*-**@@@@@%%%%####*****++++
===++++++**####%%%%%@#@*@#-#%%=@%+--===----*+@@#+=--+%=-==-=*%+#+=@%%%%%###****++++=
===++++++**####%%%%%@%@%#+@@*-+*@@%*++==-=++#@@%*#**+----==*==-++@@%%%%####****++++=
===++++++**####%%%%%@*%=#*-**#@@@@*#+===-=+#@@@@%*+*++++=--:**-=#*@%%%%####****++++=
===+++++***####%%%%@=-%#****##@@@@@+*===*++**#@%%#**+=+=====-:+-+-+%%%%###*****++++=
===++++****####%%%%%--**++%*#%@@%=###+@@@@@*#*@@%**+++++===-----:--*%%%###****++++==
===++++****###%%%%@@#===+*+%##=%@@+%@@@@@@@@@%###***++==+=-++---=-==+%###*****++++==
====+++****####%%@@@#%%*+*+=*##=#@@@@@@@@@@@@@@%***=+=#+==+=+=====-+=%####***+++====
====+++*****####%@%%=%#*-++*@++*@@@@@@@@@@@@@@@@@%*#%+-==*+=*===-=+-++####***+++====
=====++******###%@@+#@##+#=+++@@@@@@@@@@@@@@@@@@@@@@*#*#==-*=====--==*####**++++====
=====+++******##@%%*@++=+==+*@@@@@@@@@@@@@@@@@@@@@@@@@#**+*==+====--+=####***++++===
=====+++*******####=----=+-*@@##@%@@@@@@@@@@@@@@@@@@#*++%*=+**=--++---###****++++===
=====+++++*****###=%===#-=#+@@@@%%#+++#@@@@@@@@#+++*%%##%%=*-=-----+-+###****+++++==
======++++++******#+*++=-=%#*-=-:-+:*%@@@@@@@@%%#*-=-:-:-++*+-=---==#####****+++++==
========++++*******+#++--#%-::+-@----*%%@@@@@%##*::@:--*:::=*--===--####*****++++++=
=========+++++++***%-+#+=%%%*+@-%@%*@+@@@@@@@##@=@=#@@=@+=***==+*+--###******+++++==
=========+++++++***#*%@+*@%%@#%#@@@@@@@@@@@@@%%@@@@@@@++##***+==+::-=##*****+++++===
=========++++++++*%**-=@@+%%@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#***=**:::-==#****+++++====
=========++++++++%*%%+--@%@%%@@@@@@@@@@@@@@@@@@@@@@@@@@%##*#*=#::--:--****++++++====
=========+++++++#++%%*=-::+@%%@@@@@@@@@@@@@@%%@@@@@@@@%##***:=::---:-==***+++++=====
=========+++++++++##**=-%*:@%%@@@@@@@@@@%@#*-##@@@@@@%%#**#::*::----:--+**+++++=====
==========+++++++#@%*++=-::@@@@@@@@@@@@@@@%##%@@@@@@@%%###*::=:-------==**+++++=====
===========+++++**=*--+@@*#:@@@@@@@@@@@@@@@@@@@@@@@@@%###%::#++----=---=**#++++=====
============++@+++*-=++@=%-::@@@@@@@@@@#++++=+*%@@@@%%###::=*%%-=---=--=**+*+++=====
============+@+++===-##+*=::::@@@@@@@@@%@@@@#**@@@%%%###:::::+--=---:---+*+++++=====
============#++++===-%#*=-:-::::@%@@@@@@@#***#%@@%%##%:::::::*----+::-====+++++=====
=============++++**--##+-----::::=*%@@@@@@@@@@@@%##==::::::-:-----::-:=++===++++====
=============++*%+++-+*=--+-:-:::-+++%@@@@@@@@%#%====:::::-----=::---:-======++++===
============+=@@%%+=--==-#=---::::***+++%%###%===++==:::::--+*=::-==-:---======+====
============@**@%*=-*--+#%*--::::-*#%##**++++++++++==-::::-=+*++-=+--:----====-=+===
====-=======#%#**=-*%+==+==-:::::*#%%%%%##**++++**++==:::::-**++==---:-----=-=--=+==
==========**#*+=---#*-===::::-::+#%%@@@@%%%#####***+++=@:::-=====-=:=:-------=--=+==
==========+*=+==--:*%%=::-----:**#%%@@@@@@%%%%%%#****+=*=-:--:==---+=------------===
-=-===+===*+==-----*%%*+====--=+=%@@@@@@@@@%%%@@####*#++++===-::--++--------+#%@@@@@
--=@@@@@@%%*==----:+*#*+*+=--=+#%%@@@@@@@@@@@@@@@%**+##***+=*+=--%#==--:--*#%@@*#@@@
--%@@@%@@@@@*----::=**++===-+*#%%%@@*+@%%@@@@*@*%#*%%%%%%%#=+**+*#%=-:::+*#%@@@@@@@#
--@@@@@@@@%##+=---++-=+==--+*%@@@@@@@@@@@@@%@@@@@@@@@@@@@%%%+*+=+-----=+*@@++#@@@@@@
-=@@@@@@##+@@@#+=+=**--==---*%@@@@@@@@@@@%@++@@@@@@@@@@@@@%%+-+=--+==--+#@@@@%#%@@@@)";

string Dialogue::blacksmith =
R"(@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#####****++===
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%####****+=-=
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@%-=+-@@@@@@@@@@@@@@@@@@@%%%####****++==
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*=:-=:+=%**@@@@@@@@@@@@@@@@%%%####****++++=
@@@@@@@@@@@@=@@@@@@@@%@@@@@@@@@@@@@@@@#%#*+---::++:-=@@@@@@@@@@@@@@@%***++*##***++++
@@@@@@@@@@@@-==--@@@@@@@@@@@@@@@@@@@@@@@@@@%%@@@@%+-:%@@@@@@@@@@@@@@@%****####***+++
@@@@@@@@@@@@:--:-@===:%-@:@@@@@@@@@@@@@@@@%@@@@@@#+=@@@@@@@@@@@@@@@@@%+**#%%##****++
@@@@@@@@@@@:::::::.::::-++++:==+=-@@@@@@@@*%+*@@%%#:#@@@@@@@@%@@@@@@@###***###*+++++
@@@@@@@@@@@@@@@@@@+:--:::.=.:::--:@@@@@@-*+:@=-::*%-*@@@@@@@@@@@@@@@@@@%%####*****++
@@@@@@@@@@@@@@@@@@#=-+=++=@@#::::@@@@@@@*#@@@@@@@%#+@@@@@@@@@@@@@@@@%@@%%%%%#####***
@@@@@@@@@@@@@@@@@@=%-#:@@@@@@@@@@@@@@@@@%#=*#:@#%*:@%@@@@@@@@@@@@@@@@@@@@%%%%#####*+
@@@@@@@@@@@@@@@@@@=#-=:@@@@@@@@@@@@@@#*+@@%=-==##-:-=@@@@@@@@@@@@@@@@@@@%%%#######*+
@@@@@@@@@@@@@@@@@@@====@@@@@@@@@@*@*=#@@*--+=*+-+----+#@@@@@@@@@@@@@@@@%%@@#*#####*=
%%@@@@@@@@@@@@@@@-+@@:**@@@@@@+*+@@-#@@@%%++==*+:=--=-=%*@@@@@@@@@@@@@@@@@@**#####*=
@@@@@@@@@@@@@@@@##@%@:=@@@@@@=@::-==::=@+##----=::-=*---=+#@@@@@@@@@@@@@@#+**###%#+-
@@@@@@@@@@@@@@@%#%%@==-=-=%-::-::-:--:*@%==-=-+=-:===--==#@@-@@@@@@@@@@@@%%#***##*=:
@@@@@@@@@@@@@@@=*%@@:#-::-*:::::.:--==+@@+*-===::..#--+*+*+@*=@@@@@@@@@@@@@@#*%%#+-:
@@@@@@@@@@@@@@%*---:+*:::::::::::-+:-=:@=++==*--::::-@+@*+++#@%-=@@@@@@@@@@@%*@%*=::
@@@@@@@@@@@@@@#=--%-*-*:::::::::.:-:-=-#:#-:::--=-:-=+#-%*+=+==#-=-@@@@@@@@@%*@%+::-
%%%@@@@@@@@@@@==--%=+-*=::...:-::-::::=@=::--#:=-::=:=-#*@*+*@##*:-:@@@@@@@@**#*=:-=
%%@@@@@@@@@@@@@@@#==*-@@@@::.....--:--:++=@:-=#==.#-=:+=-====%--@@-=@@@@@@@@%%%+::=+
####%%@@@@@@@@@@@@*=+:@@@@@::.:@@@-:*-:++===--:*::*+:#=:==---@===*=-@@@@@@@@@@#-:-++
%%%%#%%%%%@@@@@@@@+-==@@@@@@@@@@@@:-+--=*@@-:-::.@:=@%.=+#+*=#++=%--=@@@@@@@@%+:-=++
%%%%%@@@@@@@@@@@@@=**-@@@@@@@@@@@@:-----=#=:::::=+.@---=+===-=%--=-+@=@@@@@%%+::=+++
*####%%%@@@@@@@@@@==*:@@@@@@@@@@@-:@---==@=:-::===.*+.---#*-:=#==@=---+@@@@%+::-=+==
*#####%@@@@@@@@@@@**+:@@@@@@@@@@@-:+=--==+=-:::++-..--+::-*::#@--:=:++:@@@%*-:==+++*
**%%%%%@@@@@@@@@@@%*+:@@@@@@@@@@@=:*--==##%:::-**-.@::--==@*:=*+++*=+*-@%%*-:++++***
++**##%%@@@@@@@@@@++=:@@@@@@@@@@@@====++*=::::+--:.#.-++:-:-+-*#=-=--+-@%#-:=*++****
++==+*#%%@@@@@@@@@--=-@@@@@@@@@@@@@==*==-:::--=:-:..::::--:#--#*-----+:@%=:-==+****+
====+***#%%@@@@%%+---#%@@@%%%@@@@@@++-:::::--@*--:..::::::++++##=+@+=+@@*-:-=+*###**
+++*******#%@@@@@+-=-@@@@%@@%%%@@@@=---======@-::...-==:-:#*-==%%=----@#-:-=++*##***
++++**######%%@@@=-=-@%%%%%%%%%%%@@@--:=-==--*::......:-:#+=:-+#*-==--%-:-=+++*#****
+++*****##%%###%@-=+-@%%%%%%%@@@@@@==-::::---=:::::....@%#@@@*+@%+==---:-=++****++++
++++**#***###**#@+=--@@@@@@@@@@@@@@*=--:::::--::::::...:.:....:-*--+==:=++****++++++
+++++++**#*####%*==+-*@%#*#@@@@@@@@@---:-:-::.:::::....*:-====-==-:::==++*****++++**
@@@@@@*-:***####=:::.@@@@%%#%@@@%@=@@-::-:.:::::::::...:#--*+-:=---::+*+******++****
*-:::::=**********##%%%%%@@@@@@@@..#@*+.:::--:::......##%%@%::+*=+=:=#***##*******++
:::..=+****+**##**+******#%%%%%%..=-:-=+:.....:::::..%##-=-:.:::=---=********+++++++
....=+++*****#####***++**##****:.@%*@@-:::-:-:---:::%@+:+==::....---******++++++==++
.::======++++*******#######****..@#%:.---::::::...+@%+:-=-:-=:=-:::***###***+==+++++
:::-===========++++***+*%@%##****##%-==----:::-:*@%#**=:-:-::-:.::-#%%%%##*+=+*++++=
:::-==========++====+++++*#%@@@@@*..-:----:--:*@%**==---:::==-:.::::%#**+==+**+++++-
::---==========+++++++++*********#+-::.:::::*@@@%#+=-==-:..::..---..-+++++**##*+++=:
-------------===#@@@@@@%--=*@@@%**#@@@@@@@@@@@%#+=+--......:::::::********+*##*+++-:
::::----------*=+%##@@@@@@@@***##@@@@%#@@@@@#++=-..........-::-.==*-+****++**=-===:.
::::::::------*=-:::::::::----=::::-==++:=-==::-:::::......::.--:::.=***++++**+=+-:.)";
